<html>
    <head>
        <title>Project 2</title>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
        <style> 
            
            body
            {
                font-family: sans-serif;
                background-color: #404040;
            }
            
            svg { 
                width: 60%;
                border: solid #ccc 0.75px;
                margin-left: 40px;
            } 
            
            .button{
                background-color: transparent;
                color: #CCCCCC;
                text-align: center;
                padding: 16px;
                text-decoration: none;
                display: inline-block;
                font-size: 14px;
                margin: 4px 2px;
                cursor: pointer;
                -webkit-transition-duration: 0.4s; /* Safari */
                transition-duration: 0.4s;
                border: 1px solid;
                outline: none;
                width:100%;
                border-radius: 6px;
                font-weight: 100;
            }
            
            #buttonHolder
            {
                display: inline-block;
                float: left;
                width:150px;
                margin: 20px;
            }
            
            #holder
            {
                display: inline-block;
                float: left;
            }
            
            h2, h3{
                
                color:white;
            }
            
        </style>
    </head>

    <body>
        <h2>F1 Race Results</h2>
        <h3>Races</h3>
        <div id="holder">
            <div id="buttonHolder"></div>
            <br>
            <svg id="Graph" width="1600" height="800">
            </svg>
        </div>
        <script>
            //List of Races in F1 2011
            var race_list = ["Belgium","Canada","EUGP","Germany","Hungary","India","Italy","Japan","Korea","Monaco","Silverstone","Singapore","Spain"]
            
            var race_color = ["#ee6d66","#f49cc8","#a866ee","#D23232","#7166ee","#3080e8","#107c91","#16c79e","#d59f80","#FFBF00","#FF7900","#56A902","#66d7ee"]
            
            //Load Data Files
            var race_data;
            var start_data;
            var result_data;
            
            var queue = d3.queue();
            race_list.forEach(function(race_name){
                //Queue all data files
                queue.defer(d3.json, "RaceData_JSON/"+race_name+".json")
                queue.defer(d3.json, "RaceStart_JSON/"+race_name+".json")
                queue.defer(d3.json, "RaceResults_JSON/"+race_name+".json")
            });
            queue.awaitAll(function (error, data){
                race_data = data;
                //Name all races
                for (i=0; i<race_list.length; i++){
                    race_data[i].name = race_list[i];
                }
            });
            
            
            
            
 
            //Function to initialize graph when button is clicked
            //
            // Called from "on click" event of a button
            // Creates graph of clicked race with top 3 finishers selected
            // Removes old graph stuff
            // Creates clickable buttons for each racer
            var testy;
            var testy2;
            
            function initializeRace(racename) {
                var race = race_data.filter(function(d) {return d.name == racename;})
                race = race[0];
                testy = race;
                for (var driver in race) {
                    if (driver != "name"){
                        console.log(driver);
                        race[driver];
                    }
                }
            }
            
            
            
            
            //Adding buttons above SVG
            var button_holder = d3.select("#buttonHolder");
            var buttons = button_holder.selectAll("input").data(race_list);
            
            var buttonClicked = false;
            buttons.enter()
            .append("input")
            .attr("type","button")
            .attr("class","button")
            .attr("clicked","false")
            //.attr("id",function(d,i){return "button"+i})
            .attr("value", function (d){return d; })
            .style("border-color", function(d,i){return race_color[i];})
            .on("click", function(d,i)
                {
                    if(d3.select(this).attr("clicked")=="false")
                        {
                            clearButtons()
                            d3.select(this).attr("clicked","true")
                            makeButtonColored(this,i)
                            initializeRace(d);   
                        }
                    else
                        {
                            d3.select(this).attr("clicked","false")
                            makeButtonTransparent(this)
                            //initializeRace(d); 
                        }
            })
            .on("mouseover", function(d,i)
               {
                makeButtonColored(this,i)
            })
            .on("mouseout",function(d)
               {
                   if(d3.select(this).attr("clicked")=="false")
                    {
                        makeButtonTransparent(this);
                    }
            });
          
            function clearButtons()
            {
                button_holder.selectAll("input").
                style("background-color","transparent")
                .attr("clicked","false");
            }
            
            function makeButtonColored(btn, i)
            {
                d3.select(btn).style("background-color",race_color[i]);
                d3.select(btn).style("color","white");
                d3.select(btn).style("font-weight",500); 
            }
            
            function makeButtonTransparent(btn)
            {
                d3.select(btn).style("background-color","transparent"); 
                d3.select(btn).style("color","#CCCCCC"); 
                d3.select(btn).style("font-weight",100);
            }
            
           //console.log(buttons) 
            
            
        </script>        
    </body>
</html>